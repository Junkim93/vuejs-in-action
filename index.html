<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vue.js 장바구니</title>
    <link rel="stylesheet" href="./assets/reset.css" />
    <link rel="stylesheet" href="./assets/styles.css" />
    <script
      src="https://unpkg.com/vue/dist/vue.js"
      type="text/javascript"
    ></script>
  </head>

  <body>
    <div id="app">
      <header class="app-header">
        <h1 class="app-header__title" v-text="sitename"></h1>
        <button class="app-header__checkout" @click="showCheckout">
          체크아웃
        </button>
      </header>

      <main class="app-body" v-if="showProduct">
        <div class="app-body__product">
          <img
            class="app-body__product__image"
            :src="product.image"
            alt="cat product"
          />
          <section class="app-body__product__info">
            <h2
              class="app-body__product__info-title"
              v-html="product.title"
            ></h2>
            <p
              class="app-body__product__info-description"
              v-html="product.description"
            ></p>
            <p class="app-body__product__info-price">
              {{ product.price | formatPrice }}
            </p>
            <button
              class="app-body__product__info-cart"
              @click="addToCart"
              :disabled="!canAddToCart"
            >
              장바구니 담기
            </button>
            <p v-text="cart"></p>
          </section>
        </div>
      </main>
      <main class="app__checkout" v-else>
        <header>애완용품샵 체크아웃</header>
        <h3>정보를 입력하세요</h3>
        <form>
          <div class="form-divide-row">
            <div class="form-divide-column">
              <strong>성:</strong>
              <input type="text" v-model="order.lastName" />
            </div>
            <div class="form-divide-column">
              <strong>이름:</strong>
              <input type="text" v-model.trim="order.firstName" />
            </div>
          </div>
          <div class="form-group">
            <strong>주소:</strong>
            <input type="text" v-model.trim="order.address" />
          </div>
          <div class="form-group">
            <strong>도시:</strong>
            <input type="text" v-model.trim="order.city" />
          </div>
          <div class="form-group">
            <div class="form-divide-row">
              <div class="form-divide-column">
                <strong>주:</strong>
                <select v-model="order.state">
                  <option disabled value="">주</option>
                  <option
                    v-for="(state, key) in states"
                    :value="state"
                    v-text="key"
                  >
                  </option>
                </select>
              </div>
              <div class="form-divide-column">
                <strong>우편번호:</strong>
                <input type="text" v-model.number="order.zip" />
              </div>
            </div>
          </div>
          <div class="form-divide-row">
            <div>
              <input
                type="checkbox"
                id="gift"
                value="true"
                :true-value="order.sendGift"
                :false-value="order.dontSendGift"
                v-model="order.gift"
              />
              <label for="gift">선물로 보내기?</label>
            </div>
            <div>
              <input
                type="radio"
                id="home"
                :value="order.home"
                v-model="order.method"
              />
              <label for="home">자택</label>
              <input
                type="radio"
                id="business"
                :value="order.business"
                v-model="order.method"
              />
              <label for="business">직장</label>
            </div>
          </div>
          <div class="form-align-center">
            <button type="submit" @click="submitForm">주문하기</button>
          </div>
        </form>
        <pre class="order-info">
            성: {{ order.lastName }}
            이름: {{ order.firstName }}
            주소: {{ order.address }}
            도시: {{ order.city }}
            우편번호: {{ order.zip }}
            주: {{ order.state }}
            배송지: {{ order.method }}
            선물: {{ order.gift }}
        </pre>
      </main>
    </div>

    <script type="text/javascript">
      var app = new Vue({
        el: '#app',

        data () {
          return {
            showProduct: true,
            sitename: 'Vue.js 애완용품샵',
            product: {
              id: 1001,
              title: '고양이 사료,<br>25파운드',
              description:
                '당신의 고양이를 위한 <em>거부할 수 없는</em>, 유기농 25파운드 사료입니다.',
              price: 2000,
              image: 'assets/images/cat-product.jpg',
              availableInventory: 5
            },
            cart: [],
            order: {
              firstName: '',
              lastName: '',
              address: '',
              city: '',
              zip: '',
              state: '',
              method: '자택',
              home: '자택 주소',
              business: '회사 주소',
              gift: '선물로 보내기',
              sendGift: '선물로 보내기',
              dontSendGift: '선물로 보내지 않기'
            },
            states: {
              AL: '알라바마',
              AR: '애리조나',
              CA: '캘리포니아',
              NV: '네바다'
            }
          }
        },

        computed: {
          cartItemCount () {
            return this.cart.length || ''
          },

          canAddToCart () {
            return this.cartItemCount < this.product.availableInventory
          }
        },

        filters: {
          formatPrice (price) {
            if (!parseInt(price)) return ''
            if (price > 99999) {
              const priceString = (price / 100).toFixed(2)
              const priceArray = priceString.split('').reverse()
              const index = 3
              while (priceArray.length > index + 3) {
                priceArray.splice(index + 3, 0, ',')
                index += 4
              }
              return '$' + priceArray.reverse().join('')
            } else {
              return '$' + (price / 100).toFixed(2)
            }
          }
        },

        methods: {
          addToCart () {
            this.cart.push(this.product.id)
          },

          showCheckout () {
            this.showProduct = this.showProduct ? false : true
          },

          submitForm () {
            alert('제출완료')
          }
        }
      })
    </script>
  </body>
</html>
